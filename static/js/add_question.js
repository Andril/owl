// Generated by CoffeeScript 1.3.3
(function() {
  var get_question_template, parse_classic_question, parse_question;

  parse_question = function() {
    var question, res, subject, theme;
    theme = $(':input#theme').val();
    subject = $(':input#subject').val();
    question = $(':input#question').val();
    return res = {
      theme: theme,
      subject: subject,
      question: question
    };
  };

  parse_classic_question = function() {
    var answer, answers, q, res, right, tmp_ans, tmp_right, _i, _j, _len, _len1;
    res = parse_question();
    tmp_ans = $(':input.answer');
    tmp_right = $(':input.right');
    answers = [];
    for (_i = 0, _len = tmp_ans.length; _i < _len; _i++) {
      answer = tmp_ans[_i];
      q = $(answer).data('a');
      answers[q] = {
        text: answer.value,
        right: false
      };
    }
    for (_j = 0, _len1 = tmp_right.length; _j < _len1; _j++) {
      right = tmp_right[_j];
      if (right.checked) {
        q = $(right).data('a');
        answer[q].right = true;
      }
    }
    res.answers = answers;
    return res = JSON.stringify(res);
  };

  get_question_template = function(val) {
    return "<div class='answer'><label>Answer " + (val + 1) + ":</label><br>					<input type='text' class='answer' data-a='" + val + "'>					<input type='checkbox' class='right' data-a='" + val + "'>					</div>";
  };

  $(document).ready(function() {
    $('button#submit').click(function(event) {
      var res;
      event.preventDefault();
      res = parse_classic_question();
      console.log(res);
      return $.ajax({
        type: 'POST',
        contentType: 'application/json; charset=; utf-8',
        data: res,
        success: function(data) {
          return console.log('ajax success');
        },
        error: function() {
          return console.log('ajax error');
        }
      });
    });
    $('button#add').click(function(event) {
      var template, val;
      event.preventDefault();
      val = parseInt($(':input.answer:last').data('a')) + 1;
      if (isNaN(val)) {
        val = 0;
      }
      template = get_question_template(val);
      return $('div#control').before(template);
    });
    return $('button#remove').click(function(event) {
      event.preventDefault();
      return $('div.answer:last').remove();
    });
  });

}).call(this);
